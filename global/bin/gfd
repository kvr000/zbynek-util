#!/bin/sh

set -e

globalOpt=
if [ "x$1" = "x-C" ]; then
	globalOpt="$globalOpt $1 $2"; shift; shift
fi

if [ $# -gt 0 ]; then
	date="$1"; shift
else
	date="`git $globalOpt show --date=iso | grep ^Date: | sed 's/^Date:[ 	]*//'`"
fi
gdate="$date"
export GIT_AUTHOR_DATE="$gdate"
export GIT_COMMITTER_DATE="$gdate"
git $globalOpt commit --date="$gdate" --amend --no-edit "$@"
